{
    "contents" : "## Give a circRNA count data, plot a certain row or plot all rows\n#' @title Circ.ratioplot\n#' \n#' @description\n#' Plot the ratio of circRNAs to the total transcripts (circRNA plus liner RNA).\n#' @param Circ CircRNACount file. A file of circRNA read count table. First three columns are circRNA coordinates, and followed by columns for circRNA read counts, each sample per column. \n#' @param Linear LinearCount file. A file of circRNA host gene expression count table. Same configuration as CircRNACount file.\n#' @param plotrow The rownumber or rowname in the CircRNACount table corresponding the specific gene which you want to plot.\n#' @param size the text size\n#' @param ncol if groupindicator2 is provided, specify the panel layout.\n#' @param CircCoordinates BED format circRNA coordinates file. \n#' @param groupindicator1 A vector of group indicators. For example, ages. \n#' @param groupindicator2 An other vector of group indicators. For example, tissues. This indicator will be used to segement plots out.\n#' @param x x axis lable\n#' @param y y axis lable\n#' @param lab_legend legend title\n#' @examples data(Coordinates)\n#' data(Circ)\n#' data(Linear)\n#' @examples data(Coordinates)\n#' data(Circ)\n#' data(Linear)\n#' Circ.ratioplot(Circ,Linear,Coordinates,plotrow=10,groupindicator1=c(rep('1days',6),rep('4days',6),rep('20days',6)),groupindicator2=rep(c(rep('Female',4),rep('Male',2)),3),lab_legend='Ages')\n#' \n#' @export Circ.ratioplot\n#' \nCirc.ratioplot <- function(Circ,Linear,CircCoordinates,plotrow='1',size=18,ncol=2,groupindicator1=NULL,groupindicator2=NULL,x='Conditions',y='circRNA/(circRNA+Linear)',lab_legend='groupindicator1'){\n  require(ggplot2)\n  #require(Rmisc)\n  \n  if( !is.null(groupindicator1) & length(groupindicator1) != ncol(Circ)-3 ){\n    stop(\"If provided, the length of groupindicator1 should be equal to the number of samples.\")\n  }\n  if( !is.null(groupindicator2) & length(groupindicator2) != ncol(Circ)-3 ){\n    stop(\"If provided, the length of groupindicator2 should be equal to the number of samples.\")\n  }\n  if(is.null(groupindicator1)){\n    stop(\"At least one grouping should be provided through groupindicator1.\")\n  }\n  if(!is.null(groupindicator2)){\n    twolevel <- TRUE\n  }else{\n    twolevel <- FALSE\n  }\n  \n  Circ <- data.frame(lapply(Circ, as.character), stringsAsFactors=FALSE)\n  Linear <- data.frame(lapply(Linear, as.character), stringsAsFactors=FALSE)\n  CircCoordinates <- data.frame(lapply(CircCoordinates, as.character), stringsAsFactors=FALSE)\n  \n  # Get gene name, if no annotation, output NA\n  genename <- as.character(CircCoordinates[plotrow,4])\n  if (genename == '.'){\n    genename = NA\n  }\n  \n  if(twolevel){\n    plotdat <- summarySE( data.frame(Ratio=as.numeric(Circ[plotrow,-c(1:3)])/(as.numeric(Linear[plotrow,-c(1:3)])+as.numeric(Circ[plotrow,-c(1:3)])),\n                                    groupindicator1,\n                                    groupindicator2),\n                         measurevar='Ratio',groupvars=c('groupindicator1','groupindicator2') )\n  }else{\n    plotdat <- summarySE( data.frame(Ratio=as.numeric(Circ[plotrow,-c(1:3)])/(as.numeric(Linear[plotrow,-c(1:3)])+as.numeric(Circ[plotrow,-c(1:3)])),\n                                     groupindicator1),\n                                     measurevar='Ratio',groupvars=c('groupindicator1') )\n  }\n  #View(plotdat)\n  Q <- ggplot(plotdat, aes(x=groupindicator1, y=Ratio)) +\n       theme(text=element_text(size=size))+\n       theme_bw()+\n       labs(list(title=paste(toString(Circ[plotrow,c(1:3)]),genename,sep=\" \"),x=x,y=y))+\n       #ggtitle(toString(Circ[plotrow,c(1:3)]))+\n       geom_errorbar(aes(ymin=Ratio-se, ymax=Ratio+se), width=.1 )+   # Width of the error bars\n       geom_bar(stat=\"identity\",aes(fill=groupindicator1))+\n       scale_fill_discrete(name=lab_legend)\n  if(twolevel){\n    Q <- Q + facet_wrap( ~ groupindicator2,ncol=ncol )\n  }\n\n  print(Q)\n}\n\n",
    "created" : 1432841074228.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "3910241438",
    "id" : "7D93FF8",
    "lastKnownWriteTime" : 1432842189,
    "path" : "~/Documents/Rat_project/CircTest/R/Circ.ratioplot.R",
    "project_path" : "R/Circ.ratioplot.R",
    "properties" : {
    },
    "source_on_save" : false,
    "type" : "r_source"
}